var Y=Object.defineProperty;var _=(i,t,e)=>t in i?Y(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var b=(i,t,e)=>(_(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();class W{run(){if(this.running)return;this.running=!0,console.log("%c%s","color: #1abc9c; font-weight: bold","Made with bottlecap.js"),this.init(),this._lastStep=performance.now();const t=()=>{this.step(),this._lastStep=performance.now(),this._frameRequest=requestAnimationFrame(t)};requestAnimationFrame(t)}stop(){this._frameRequest&&cancelAnimationFrame(this._frameRequest),this._frameRequest=null,this.running=!1}step(){const t=performance.now(),e=(t-this._lastStep)/1e3;this._lastStep=t,this.update(e),this.render()}init(){console.log("Game Initialized")}update(t){}render(){}}const A=(i,t,e,s)=>{const r=i-e,n=t-s;return Math.sqrt(r*r+n*n)};class a{constructor(t=0,e=0){this.x=t,this.y=e}static zero(){return new a}static create(t,e){return new a(t,e)}static clone({x:t,y:e}){return a.create(t,e)}static copy(t,e){return Object.assign(t,e)}static set(t,e,s){return t.x=e??t.x,t.y=s??t.y,t}static add(t,{x:e,y:s}){return t.x+=e,t.y+=s,t}static sub(t,{x:e,y:s}){return t.x-=e,t.y-=s,t}static mul(t,{x:e,y:s}){return t.x*=e,t.y*=s,t}static div(t,{x:e,y:s}){return t.x/=e,t.y/=s,t}static addScalar(t,e){return t.x+=e,t.y+=e,t}static subScalar(t,e){return t.x-=e,t.y-=e,t}static mulScalar(t,e){return t.x*=e,t.y*=e,t}static divScalar(t,e){return t.x/=e,t.y/=e,t}static angle(t){return Math.atan2(-t.y,-t.x)+PI}static calcLength(t){return Math.sqrt(t.x*t.x+t.y*t.y)}static equals(t,e){return t.x===e.x&&t.y===e.y}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static lerp(t,{x:e,y:s},r){return t.x+=(e-t.x)*r,t.y+=(s-t.y)*r,t}static normalize(t){return a.divScalar(t,a.calcLength(t)||1),t}static distance(t,e){return A(t.x,t.y,e.x,e.y)}}const q=Math.round;class H{constructor(t,e=0,s=0,r=0,n=0){this.ctx=t,this.pos=a.create(e,s),this.target=a.zero(),this.cx=q(t.canvas.width/2)-r,this.cy=q(t.canvas.height/2)-n}attach(){this.ctx.save(),this.ctx.translate(this.pos.x,this.pos.y)}detach(){this.ctx.restore()}update(t){a.set(this.pos,this.cx-this.target.x,this.cy-this.target.y)}lookAt(t,e){a.set(this.target,t,e)}}class U{constructor(){this.topics={}}emit(t,...e){const s=this.topics[t];!s||s.size<0||s.forEach(r=>r(...e))}hasTopic(t){return Reflect.has(this.topics,t)}on(t,e){return this.hasTopic(t)||(this.topics[t]=new Set),this.topics[t].add(e),()=>this.off(t,e)}once(t,e){const s=(...r)=>{this.off(t,s),e(...r)};return this.on(t,s)}off(t,e){this.hasTopic(t)&&this.topics[t].delete(e)}destroy(){this.topics={}}}const l=document,v=/([.#])/,X="http://www.w3.org/2000/svg",P=i=>{const t=i.split(v);let e="",s="";for(let r=1;r<t.length;r+=2)switch(t[r]){case".":s+=` ${t[r+1]}`;break;case"#":e=t[r+1]}return{tag:t[0]||"div",className:s.trim(),id:e}},j=i=>{const{tag:t,id:e,className:s}=P(i),r=l.createElement(t);return e&&(r.id=e),s&&(r.className=s),r},J=i=>{const{tag:t,id:e,className:s}=P(i),r=l.createElementNS(X,t);return e&&(r.id=e),s&&R(r,"class",s),r},$=()=>l.createDocumentFragment(),K=(i="")=>l.createTextNode(i),B=(i,t=l)=>t.querySelector(i),Q=(i,t=l)=>t.querySelectorAll(i),Z=(i,t)=>Object.assign(i.style,t),R=(i,t,e)=>{if(e===void 0)return i.getAttribute(t);e===!1?i.removeAttribute(t):i.setAttribute(t,e)},m=(i,t,e)=>i.addEventListener(t,e,!1),F=(i,t,e)=>i.removeEventListener(t,e,!1),V=i=>{/complete|loaded|interactive/.test(l.readyState)&&l.body?setTimeout(i,1):m(l,"DOMContentLoaded",i)};var tt=Object.freeze({__proto__:null,attr:R,el:j,frag:$,off:F,on:m,qs:B,qsa:Q,ready:V,setStyle:Z,svg:J,text:K});const z=a.zero(),I={},f=class f{static keyDown(t){return!!I[t]}static getDirection(){const t=f.keyDown,e=f.KEYS,s=t(e.LEFT)?-1:t(e.RIGHT)?1:0,r=t(e.UP)?-1:t(e.DOWN)?1:0;return a.set(z,s,r),z}};b(f,"KEYS",{LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",SPACEBAR:" ",ESCAPE:"Escape",ENTER:"Enter",CTRL:"Control",TAB:"Tab",ALT:"Alt",W:"w",A:"a",S:"s",D:"d",E:"e",X:"x",Z:"z"});let O=f;const et=i=>{i.defaultPrevented||(I[i.key]=!0,i.preventDefault())},st=i=>I[i.key]=!1;m(window,"keydown",et);m(window,"keyup",st);const p=Math.abs,y={TOP:"top",BOTTOM:"bottom",LEFT:"left",RIGHT:"right"};class it{static circleInCircle(t,e,s,r,n,o){return A(t,e,r,n)<=s+o}static pointInCircle(t,e,s,r,n){return A(t,e,s,r)<=n}static rectInRect(t,e,s,r,n,o,h,c){return t<n+h&&t+s>n&&e<o+c&&e+r>o}static pointInRect(t,e,s,r,n,o){return s<=t&&t<=s+n&&r<=e&&e<=r+o}static circleInRect(t,e,s,r,n,o,h){const c=o/2,d=h/2,S=p(t-r-c),E=p(e-n-d);if(S>c+s||E>d+s)return!1;if(S<=c||E<=d)return!0;const T=S-c,L=E-d;return T*T+L*L<=s*s}static resolveCollision(t,e){const s=t.position.x+t.size.x/2-(e.position.x+e.size.x/2),r=t.position.y+t.size.y/2-(e.position.y+e.size.y/2),n=t.size.x/2+e.size.x/2,o=t.size.y/2+e.size.y/2;let h="";if(p(s)<n&&p(r)<o){const c=n-p(s),d=o-p(r);c>=d?r>0?(h=y.TOP,t.position.y+=d):(h=y.BOTTOM,t.position.y-=d):s>0?(h=y.LEFT,t.position.x+=c):(h=y.RIGHT,t.position.x-=c)}return h}}let C=null;const w=()=>(C||(C=new AudioContext),C);let g=null;const M=()=>{if(!g){const i=w();g=i.createGain(),g.connect(i.destination)}return g};class rt{static play(t,e,s=0,r=!1){const o=w().createBufferSource();return o.buffer=e,o.connect(t||M()),o.loop=r,o.start(s),o}static stop(t,e=0){t.stop(e)}static setVolume(t,e){(t||M()).gain.value=e}}const k=()=>{const i=w();/interrupted|suspended/.test(i.state)&&i.resume(),F(window,"click",k)};m(window,"click",k);const u={IMAGE:"image",SOUND:"sound",JSON:"json"},nt=(i,{name:t,type:e,value:s})=>(i[e]||(i[e]={}),i[e][t]=s,i);class x{static Image(t,e){return new Promise((s,r)=>{const n=new Image;n.crossOrigin="Anonymous",n.onload=()=>s({type:u.IMAGE,name:t,value:n}),n.onerror=()=>r(new Error(`Couldn't load Image: ${e}`)),n.src=e})}static async Sound(t,e){const s=w(),r=await fetch(e);if(!r.ok)throw new Error(`Couldn't Load Sound: ${e}`);const n=await r.arrayBuffer(),o=await s.decodeAudioData(n);return{type:u.SOUND,name:t,value:o}}static async JSON(t,e){const s=await fetch(e);if(!s.ok)throw new Error(`Couldn't load the JSON file: ${e}`);const r=await s.json();return{type:u.JSON,name:t,value:r}}static async loadAll(t){return(await Promise.all(t)).reduce(nt,{})}}const ot=({name:i,type:t,src:e})=>{switch(t){case u.IMAGE:return x.Image(i,e);case u.SOUND:return x.Sound(i,e);case u.JSON:return x.JSON(i,e);default:throw new Error(`Unknown Asset Type: "${t}"`)}};class at extends U{constructor(){super(),this.queue=[],this.loading=!1}enqueue(t,e,s){if(this.loading)throw new Error("Can't Enqueue Assets While The Loader is Loading.");this.queue.push({name:t,type:s,src:e})}addImage(t,e){return this.enqueue(t,e,u.IMAGE),this}addSound(t,e){return this.enqueue(t,e,u.SOUND),this}addJSON(t,e){return this.enqueue(t,e,u.JSON),this}clearQueue(){for(;this.queue.length;)this.queue.pop()}reset(){this.clearQueue(),this.loading=!1}async load(){if(this.loading){console.error("Loader is already loading.");return}this.loading=!0;const t=this.queue.map(ot);try{const e=await x.loadAll(t);this.emit("load",e)}catch(e){this.emit("error",e)}finally{this.reset()}}}class G{constructor(t,e,s,r,n,o,h,c){this.ctx=t,this.spritesheet=e,this.numCol=s,this.numRow=r,this.frameWidth=e.width/s,this.frameHeight=e.height/r,this.position=a.create(n,o),this.size=a.create(h||this.frameWidth,c||this.frameHeight),this.maxFrames=s*r-1,this.currentFrame=0,this.flipX=!1,this.flipY=!1,this.rotation=0,this.scale=1,this.animations=new Map,this.currentAnimation=null,this.playing=!1,this.time=0}addAnimation(t,e,s,r){if(this.animations.has(t))throw new Error(`Animation with name "${t}" already exists.`);const n=new ct(this,e,s,r);return this.animations.set(t,n),this}play(t){if(!this.animations.has(t))throw new Error(`Animation with name "${t}" does not exists.`);this.currentAnimation=this.animations.get(t),this.currentFrame=this.currentAnimation.frameStart,this.playing=!0,this.time=0}stop(){this.playing=!1}update(t){if(!this.playing)return;const{frameStart:e,frameEnd:s,delay:r}=this.currentAnimation;this.time>=r&&(this.currentFrame++,this.currentFrame>s&&(this.currentFrame=e),this.time=0),this.time+=t}render(){if(!this.currentAnimation)throw new Error("Can't Render AnimatedSprite. No current animation has been set.");const[t,e]=this.currentAnimation.getFrame(this.currentFrame);this.ctx.save(),this.ctx.translate(this.position.x+this.size.x/2,this.position.y+this.size.x/2),this.ctx.scale(this.scale,this.scale),this.ctx.rotate(this.rotation),this.ctx.scale(this.flipX?-1:1,this.flipY?-1:1),this.ctx.translate(-(this.position.x+this.size.x/2),-(this.position.y+this.size.x/2)),this.ctx.drawImage(this.spritesheet,t*this.frameWidth,e*this.frameHeight,this.frameWidth,this.frameHeight,this.position.x,this.position.y,this.size.x,this.size.y),this.ctx.restore()}}class ct{constructor(t,e,s,r=100){this.sprite=t,this.frameStart=e,this.frameEnd=s||this.sprite.maxFrames,this.delay=r/1e3,this.frames=[];for(let n=this.frameStart;n<=this.frameEnd;n++)this.frames[n]=[n%this.sprite.numCol,Math.floor(n/this.sprite.numCol)]}getFrame(t){return this.frames[t]}}const D=a.create(),ht=(i,t)=>{const e=i.getBoundingClientRect(),s=i.width/e.width,r=i.height/e.height;return a.set(D,(t.clientX-e.left)*s,(t.clientY-e.top)*r),D},lt=(i=0,t=1)=>Math.random()*(t-i)+i,ut=(i=0,t=1)=>(i=Math.ceil(i),t=Math.floor(t),Math.floor(Math.random()*(t-i+1))+i),dt=i=>[...new Set(i)],pt=i=>i.sort(()=>Math.random()-.5),ft=(i,t)=>{const e=[];for(let s=0;s<i.length;s+=t)e.push(i.slice(s,s+t));return e};var N=Object.freeze({__proto__:null,chunk:ft,getMousePos:ht,random:lt,randomInt:ut,shuffle:pt,unique:dt});const mt=(i=400,t=400,e)=>{const s=document.createElement("canvas");return s.width=i,s.height=t,e&&(s.style.background=e),s};class yt{constructor(t,e){this.speed=100,this.sprite=new G(t,e.image.playerSprite,6,1,0,0,64,64),this.sprite.addAnimation("default",0,5,80),this.sprite.play("default")}update(t,e){this.sprite.position.x+=e.x*this.speed*t,this.sprite.position.y+=e.y*this.speed*t,this.sprite.flipX=e.x===-1,this.sprite.update(t)}}class gt{constructor(t,e,s,r){this.visible=!0,this.sprite=new G(t,e.image.coin,18,1,s,r,16,16),this.sprite.addAnimation("spin",0,8,30),this.sprite.play("spin")}update(t){this.sprite.update(t)}}class xt extends W{constructor(){super(),this.score=0,this.loaded=!1,this.coins=[],this.player=null,this.assets=null}init(){this.setupCanvas(),this.setupCamera(),this.loaderSetup(),console.log("Game Initialized")}setupCanvas(){this.canvas=mt(window.innerWidth,window.innerHeight,"lightgreen"),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,document.body.appendChild(this.canvas)}setupCamera(){this.camera=new H(this.ctx)}loaderSetup(){this.loader=new at,this.loader.on("load",this.onLoadingComplete.bind(this)),this.loader.on("error",this.onLoadingError.bind(this)),this.loader.addImage("coin","/coin.png").addImage("playerSprite","/player.png").addSound("coinpickup","/coin-pickup.wav").load()}onLoadingComplete(t){this.assets=t,this.createPlayer(),this.createCoins(),this.loaded=!0}onLoadingError(t){console.error("Loading error:",t),this.loaded=!1}createPlayer(){this.player=new yt(this.ctx,this.assets)}createCoins(){for(let t=0;t<20;t++){const e=N.randomInt(100,this.canvas.width-100),s=N.randomInt(100,this.canvas.height-100),r=new gt(this.ctx,this.assets,e,s);this.coins.push(r)}}update(t){if(!this.loaded)return;const e=O.getDirection();this.player.update(t,e),this.coins.forEach(s=>{s.visible&&this.checkCoinCollision(s)&&(s.visible=!1,this.score+=10,rt.play(null,this.assets.sound.coinpickup)),s.update(t)}),this.camera.lookAt(this.player.sprite.position.x,this.player.sprite.position.y),this.camera.update(t)}checkCoinCollision(t){return t.visible&&it.rectInRect(t.sprite.position.x,t.sprite.position.y,t.sprite.size.x,t.sprite.size.y,this.player.sprite.position.x,this.player.sprite.position.y,this.player.sprite.size.x,this.player.sprite.size.y)}render(){if(!this.loaded){this.renderLoadingError();return}this.clearCanvas(),this.camera.attach(),this.renderCoins(),this.player.sprite.render(),this.camera.detach(),this.renderScore()}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}renderCoins(){this.coins.forEach(t=>{t.visible&&t.sprite.render()})}renderScore(){this.ctx.fillStyle="#000",this.ctx.font="32px sans-serif",this.ctx.fillText(`Score: ${this.score}`,32,52)}renderLoadingError(){this.clearCanvas(),this.ctx.font="32px sans-serif",this.ctx.fillStyle="#ff0000";const t="Error loading assets!",e=this.ctx.measureText(t).width;this.ctx.fillText(t,this.canvas.width/2-e/2,this.canvas.height/2)}}tt.ready(()=>{new xt().run()});
